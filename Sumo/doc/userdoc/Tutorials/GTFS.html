<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <meta property="og:image" content="../images/image-facebook.jpg">
        <meta property="og:image:type" content="image/jpeg">
        <meta property="og:image:width" content="1080">
        <meta property="og:image:height" content="1080">

        
        
        <link rel="canonical" href="https://sumo.dlr.de/docs/Tutorials/GTFS.html">
        <link rel="shortcut icon" href="../images/favicon.ico">
        <title>GTFS - SUMO Documentation</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/font-awesome.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="apple-touch-icon" href="../images/apple-touch-icon.png">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->

        <script src="../js/jquery-1.10.2.min.js" defer></script>
        <script src="../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 

      <script>
        // DARK MODE
        function detectColorScheme(){
          var theme="light";

          if(localStorage.getItem("sumo-docs-theme")){
              if(localStorage.getItem("sumo-docs-theme") == "dark"){
                  var theme = "dark";
              }
          } else if(!window.matchMedia) {
              return false;
          } else if(window.matchMedia("(prefers-color-scheme: dark)").matches) {
              var theme = "dark";
          }

          if (theme=="dark") {
              document.documentElement.setAttribute("data-theme", "dark");
          }
        }
        detectColorScheme();
      </script>

    </head>

    <body>

        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary text-center">
            <div class="container-fluid">
                <!-- Collapsed navigation -->
                <div class="navbar-header">
                    <!-- Expander button -->
                    <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                </div>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href="../index.html" class="nav-link">Documentation</a>
                            </li>
                            <li class="navitem">
                                <a href="index.html" class="nav-link">Tutorials</a>
                            </li>
                            <li class="navitem">
                                <a href="../FAQ.html" class="nav-link">FAQ</a>
                            </li>
                            <li class="navitem">
                                <a href="../Downloads.html" class="nav-link">Downloads</a>
                            </li>
                            <li class="navitem">
                                <a href="../Publications.html" class="nav-link">Publications</a>
                            </li>
                            <li class="navitem">
                                <a href="../Developer/index.html" class="nav-link">Developer</a>
                            </li>
                            <li class="navitem">
                                <a href="../ChangeLog.html" class="nav-link">ChangeLog</a>
                            </li>
                            <li class="navitem">
                                <a href="https://github.com/eclipse/sumo/commits/master/docs/web" class="nav-link">Recent Changes</a>
                            </li>
                            <li class="navitem">
                                <a href="https://eclipse.org/sumo/contact/" class="nav-link">Contact</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> <u>S</u>earch
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="edit" href="https://github.com/eclipse/sumo/edit/master/docs/web/docs/Tutorials/GTFS.md" class="nav-link"><i class="fa fa-github"></i> <u>E</u>dit on GitHub</a>
                            </li>
                      <li class="nav-item dropdown">
                          <a class="nav-link dropdown-toggle" href="#" id="navbardrop" data-toggle="dropdown">
                            More <i class="fa fa-chevron-circle-down"></i>
                          </a>
                          <div class="dropdown-menu dropdown-menu-right">
                            <a class="dropdown-item no-arrow-link" href="https://github.com/eclipse/sumo/issues">Report a Bug / Issue / Typo</a>
                            <a class="dropdown-item" href="../Editing_Articles.html">Help on editing articles</a>
                            <a class="dropdown-item" href="#" data-toggle="modal" data-target="#mkdocs_keyboard_modal">Keyboard Shortcuts</a>
                            <a class="dropdown-item no-arrow-link" href="https://sumo.dlr.de/sumo_documentation.zip">Download the Documentation</a>
                            <span class="dropdown-item" id="dark-mode-div">Dark mode <label id="theme-switch" class="theme-switch" for="checkbox_theme">
                              <input type="checkbox" id="checkbox_theme">
                          </label></span>
                          </div>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container-fluid">
          <div class="row">
                <div class="col-md-3">
                  <div class="text-center"><a href="../index.html" style="display: inline-block; margin-top: 5px;"><img src="../images/sumo-logo.png" class="sumoLogo" alt="SUMO Logo" width="120px"></a></div>
                  
<div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary toc-scroll toc">
        <ul class="nav flex-column bs-sidenav">
            <p style="margin-top:5px; color:#777777;" class="text-center">Contents</p>
            <li class="nav-item main"><a href="#introduction">Introduction</a></li>
            <li class="nav-item main"><a href="#initial_network_requirements">Initial network requirements</a></li>
            <li class="nav-item main"><a href="#finding_a_data_source_for_gtfs">Finding a data source for GTFS</a></li>
            <li class="nav-item main"><a href="#mapping_gtfs_data_to_the_network">Mapping GTFS data to the network</a></li>
                <li class="nav-item" style="text-indent: 5px;">
                    <a href="#routes_from_shortest_path" class="nav-link">• Routes from shortest path</a>
                </li>
                <li class="nav-item" style="text-indent: 5px;">
                    <a href="#routes_from_osm" class="nav-link">• Routes from OSM</a>
                </li>
            <li class="nav-item main"><a href="#using_the_outputs_in_a_simulation">Using the outputs in a simulation</a></li>
        </ul>
    </div>

    <div class="admonition conference" style="position: sticky; margin-top: 20px; margin-bottom:10px;">
        <p>visit <a href="https://eclipse.org/sumo">eclipse.org/sumo</a></p>
        </div>

</div>
                  <!--  -->
                </div>
                <div class="col-md-9 main-area" role="main">
                   <!-- page.is_homepage seems to be broken in Mkdocs > 1.1.0 -->
                  <ul class="breadcrumbs">
    <script>
        var pagePath = "/docs/Tutorials/GTFS.html";
        var splitUrl = pagePath.split("/");
        splitUrl.pop();
        splitUrl.shift();
        if (splitUrl[0] == 'docs') splitUrl.shift();
        var homeLink = "../index.html";
        document.write('<li class="breadcrumb-item"><a href="' + homeLink + '"><i class="fa fa-home"></i></a></li>');
        var prev = '';
        
        var dirLink = splitUrl.map(function (el) {
        el = prev + el; prev = el + '/'; return el;
        });

        for (i = 0; i < splitUrl.length; i++) {
            document.write("<li class=\"breadcrumb-item\"><a class=\"no-arrow-link\" href=\"../" + dirLink[i] + "\">" + splitUrl[i] + "</a></li>");
        }
    </script>
    <li class="breadcrumb-item active">GTFS</li>
</ul>
                  <hTitles>GTFS<hr style="border: 0.5px solid #338033; margin-top: 5px !important;"></hTitles>
                  
                  

<h1 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permanent link">#</a></h1>
<p>This tutorial shows you how to refine your existing public transit (PT) simulation
scenario with data in the <a href="https://developers.google.com/transit/gtfs">General Transit Specification Format</a> (GTFS)
which is available for many regions. It is advisable to do the
<a href="PT_from_OpenStreetMap.html">Public Transport Tutorial</a> first.</p>
<p>The creation of PT simulation consists of three steps:</p>
<ol>
<li>Initial network requirements</li>
<li>Finding a data source for GTFS</li>
<li>Mapping GTFS data to the network</li>
</ol>
<h1 id="initial_network_requirements">Initial network requirements<a class="headerlink" href="#initial_network_requirements" title="Permanent link">#</a></h1>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Using the <a href="OSMWebWizard.html">osmWebWizard tool</a>, may be the easiest way to get a network but the process works with every (geo referenced) SUMO network.</p>
</div>
<p>The process works best with a network which comes from OpenStreetMap and also
has public transport lines data (see <a href="../Networks/Further_Outputs.html#public_transport_lines">ptLines output</a>).
The network should contain edges for all traffic types (modes) you want
to model and the relevant edge types. The script currently supports
the following mapping:</p>
<ul>
<li>tram -&gt; railway.tram or highway.*|railway.tram</li>
<li>subway -&gt; railway.subway</li>
<li>light_rail -&gt; railway.light_rail</li>
<li>rail -&gt; railway.rail</li>
<li>bus -&gt; highway.*</li>
<li>ship -&gt; ship</li>
</ul>
<p>If the network does not contain edge types only a bus mapping is possible which will use all available edges.</p>
<p>For this tutorial we imported the network of Eichwalde with the osmWebWizard tool:</p>
<p><img src="../images/Eichwalde_net.png" alt="Eichwalde_net" width="600"></p>
<h1 id="finding_a_data_source_for_gtfs">Finding a data source for GTFS<a class="headerlink" href="#finding_a_data_source_for_gtfs" title="Permanent link">#</a></h1>
<p>There are several sources for GTFS data usually on the website of you local
transit agency. <a href="https://gist.github.com/highsource/67d0846029a43ea28dfd90540bacb1ee">Some examples from Germany</a>:</p>
<ul>
<li><a href="https://www.vbb.de/vbb-services/api-open-data/datensaetze/">Berlin and Brandenburg (VBB)</a></li>
<li><a href="https://www.vbn.de/service/entwicklerinfos/">Lower Saxony and Bremen</a></li>
<li><a href="https://suche.transparenz.hamburg.de/?q=gtfs">Hamburg</a></li>
</ul>
<p>This tutorial uses the <a href="https://sumo.dlr.de/daily/GTFS_VBB_Juni-Dezember-2019.zip">June 2019 dataset by VBB</a>.
You can either download the data or give the URL of the file directly to the script.</p>
<h1 id="mapping_gtfs_data_to_the_network">Mapping GTFS data to the network<a class="headerlink" href="#mapping_gtfs_data_to_the_network" title="Permanent link">#</a></h1>
<p>If you have all the data available you need to decide on the date you want to model. The script cannot find a representative date
by itself, you need to find one yourself. It is usually advisable to check the calendar for school (and other) holidays in advance.</p>
<p>For this tutorial we choose 04.09.2019 (a Wednesday).</p>
<p>Additionally, you can choose which public transport modes should be imported 
(bus, tram, train, subway and/or ferry). By default, all modes will be imported. For
this tutorial we will only import buses.</p>
<p>Depending of the input files available, you can choose between two different ways
of generating the routes.</p>
<p>The GTFS files should be in zip format and contain at least routes.txt, stops.txt,
stop_times.txt, trips.txt calendar.txt and calendar_dates.txt. If your GTFS data
doesn't have the shapes.txt file and/or you don't count with the ptLine definitions 
from OSM, follow the steps of <a href="GTFS.html#routes_from_shortest_path">Routes from shortest path</a>.
If you do count with the mentioned files, then you can follow the steps of <a href="GTFS.html#routes_from_osm">Routes from OSM</a>.</p>
<h2 id="routes_from_shortest_path">Routes from shortest path<a class="headerlink" href="#routes_from_shortest_path" title="Permanent link">#</a></h2>
<p>In this case, the route for each public transport vehicle will be defined by
finding the fastest path between stops.</p>
<p>If you have downloaded the network and the GTFS data (or have the URL) it is as easy as</p>
<div class="codehilite"><pre><span></span>python tools/import/gtfs/gtfs2pt.py -n osm.net.xml --gtfs GTFS_VBB_Juni-Dezember-2019.zip --date 20190904 --modes bus --vtype-output pt_vtypes.xml
</pre></div>

<p>The script runs for about five minutes and generates several subdirectories but in the end it provides three output files:</p>
<ul>
<li>pt_vtypes.xml</li>
<li>gtfs_publictransport.add.xml (defining the static routes and stops)</li>
<li>gtfs_publictransport.rou.xml (defining the single public transport vehicles)</li>
</ul>
<p>The vtypes output generates very simple vehicle type definitions for the different public transport modes in use. You are encouraged to modify this file and adapt
it to the real situation especially concerning capacity (number of seats) for the different modes. You may of course also use vehicle types from another source and skip this output.</p>
<p>In order to use them in a simulation you should pass them as additional files (not route files!) in the order given above.</p>
<div class="codehilite"><pre><span></span>sumo-gui -n osm.net.xml --additional pt_vtypes.xml,gtfs_publictransport.add.xml,gtfs_publictransport.rou.xml
</pre></div>

<h2 id="routes_from_osm">Routes from OSM<a class="headerlink" href="#routes_from_osm" title="Permanent link">#</a></h2>
<p>In this case, the route for each vehicle is taken from OSM. When we imported the
net with the osmWebWizard tool, we enable the option of "import public transport",
which automatically generate the "osm_ptlines.xml" file with the public transport lines.</p>
<p>The call is:</p>
<div class="codehilite"><pre><span></span>python tools/import/gtfs/gtfs2pt.py -n osm.net.xml --gtfs GTFS_VBB_Juni-Dezember-2019.zip --date 20190904 --osm-routes osm_ptlines.xml --repair --modes bus
</pre></div>

<p>The option <strong>--repair</strong> is not mandatory but helpful. It takes the given ptLines
and try to repair them using duarouter before the mapping. If some routes of the
ptLines are not valid, then they won't be used for the mapping.</p>
<p>The script generates four output files:</p>
<ul>
<li>gtfs_publictransport.add.xml (defining the stops)</li>
<li>gtfs_publictransport.rou.xml (defining the single public transport vehicles)</li>
<li>gtfs_missing.xml contains the elements (stops and ptLines) of the GTFS data that could not be imported</li>
<li>invalid_osm_routes.txt contains the warnings and errors from the repair of the ptLines</li>
</ul>
<p>To run the simulation call:</p>
<div class="codehilite"><pre><span></span>sumo-gui -n osm.net.xml --additional gtfs_publictransport.add.xml --routes gtfs_publictransport.rou.xml
</pre></div>

<h1 id="using_the_outputs_in_a_simulation">Using the outputs in a simulation<a class="headerlink" href="#using_the_outputs_in_a_simulation" title="Permanent link">#</a></h1>
<p>Below an example of using the mapped stops and buses in a simulation by calling sumo-gui:</p>
<p><img src="../images/tutorialGTFS.gif" alt="tutorialGTFS" width="600"></p>
                </div>
          </div>
          <button onclick="goTopFunction()" id="goToTop" title="Go to top"><i class="fa fa-arrow-up"></i></button>
        </div>

        <footer class="col-md-12">
          
            <br><small><i>This page was last edited on: 05 July 2021</i></small>
          
          <hr>
            <p>Copyright &copy; 2001-2021 German Aerospace Center (DLR) and others.</p>
          <p>Follow us on <a class="no-arrow-link" href="https://www.twitter.com/eclipsesumo/"><i class="fa fa-twitter"></i></a> <a class="no-arrow-link" href="https://www.facebook.com/simulationofurbanmobility/"><i class="fa fa-facebook-square"></i></a> <a class="no-arrow-link" href="https://www.instagram.com/eclipse.sumo/"><i class="fa fa-instagram"></i></a>
          | Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a></p>
        </footer>

      <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body" style="color: #495057 !important;">
                <p>Enter your search terms:</p>
                <script async src="https://cse.google.com/cse.js?cx=004302551366764109984:1kpgtzrm6kv"></script>
                <div class="gcse-search"></div>
            </div>
            <div class="modal-footer" style="color: #495057 !important;">
                or search the sumo-user mailing list archive&nbsp;<a class="no-arrow-link" href="http://sumo-user.90755.n8.nabble.com/template/NamlServlet.jtp?macro=search_page&node=1&query=">here</a>
            </div>
        </div>
    </div>
</div>
      <script>
        window.onscroll = function() {scrollFunction()};
        
        function scrollFunction() {
          if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
            document.getElementById("goToTop").style.display = "block";
          } else {
            document.getElementById("goToTop").style.display = "none";
          }
        }
    
        function goTopFunction() {
          document.body.scrollTop = 0;
          document.documentElement.scrollTop = 0;
        }

        var base_url = "..",
            shortcuts = {"help": 191, "search": 83, "edit": 69};
        </script>
        <script src="../js/base.js" defer></script>

        <script>
          const toggleSwitch = document.querySelector('#theme-switch input[type="checkbox"]');
  
          function switchTheme(e) {
              if (e.target.checked) {
                  localStorage.setItem('sumo-docs-theme', 'dark');
                  document.documentElement.setAttribute('data-theme', 'dark');
                  toggleSwitch.checked = true;
              } else {
                  localStorage.setItem('sumo-docs-theme', 'light');
                  document.documentElement.setAttribute('data-theme', 'light');
                  toggleSwitch.checked = false;
              }    
          }
  
          toggleSwitch.addEventListener('change', switchTheme, false);
  
          if (document.documentElement.getAttribute("data-theme") == "dark"){
              toggleSwitch.checked = true;
          }
          </script>

      <div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Key</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody style="color: #495057 !important;">
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help dialog</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search the Documentation</td>
                  </tr>
                  <tr>
                    <td class="edit shortcut"><kbd>e</kbd></td>
                    <td>Edit current page on GitHub</td>
                  </tr>
                </tbody>
              </table>
            </div>
        </div>
    </div>
</div>
    </body>
</html>
